<!-- src/app/components/checkout/checkout.component.html -->
<div class="container my-5">
  <h2 class="mb-4">
    <i class="bi bi-credit-card"></i> Finaliser la commande
  </h2>

  <div class="row">
    <div class="col-lg-8">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title mb-4">Informations de livraison</h5>
          <form [formGroup]="checkoutForm" (ngSubmit)="onSubmit()">
            <div class="mb-3">
              <label for="username" class="form-label">Nom complet *</label>
              <input 
                type="text" 
                class="form-control" 
                id="username" 
                formControlName="username"
                [class.is-invalid]="f['username'].invalid && f['username'].touched">
              <div class="invalid-feedback" *ngIf="f['username'].invalid && f['username'].touched">
                Le nom doit contenir au moins 3 caractères.
              </div>
            </div>

            <div class="mb-3">
              <label for="email" class="form-label">Email *</label>
              <input 
                type="email" 
                class="form-control" 
                id="email" 
                formControlName="email"
                [class.is-invalid]="f['email'].invalid && f['email'].touched">
              <div class="invalid-feedback" *ngIf="f['email'].invalid && f['email'].touched">
                Veuillez entrer un email valide.
              </div>
            </div>

            <div class="mb-3">
              <label for="phone" class="form-label">Téléphone *</label>
              <input 
                type="tel" 
                class="form-control" 
                id="phone" 
                formControlName="phone"
                placeholder="Ex: 20123456"
                [class.is-invalid]="f['phone'].invalid && f['phone'].touched">
              <div class="invalid-feedback" *ngIf="f['phone'].invalid && f['phone'].touched">
                Veuillez entrer un numéro valide (min. 8 chiffres).
              </div>
            </div>

            <div class="mb-3">
              <label for="address" class="form-label">Adresse complète *</label>
              <textarea 
                class="form-control" 
                id="address" 
                rows="3" 
                formControlName="address"
                [class.is-invalid]="f['address'].invalid && f['address'].touched"></textarea>
              <div class="invalid-feedback" *ngIf="f['address'].invalid && f['address'].touched">
                L'adresse doit contenir au moins 10 caractères.
              </div>
            </div>

            <div class="d-grid gap-2">
              <button 
                type="submit" 
                class="btn btn-primary btn-lg"
                [disabled]="checkoutForm.invalid || isSubmitting">
                <span *ngIf="!isSubmitting">
                  <i class="bi bi-check-circle"></i> Confirmer la commande
                </span>
                <span *ngIf="isSubmitting">
                  <span class="spinner-border spinner-border-sm me-2"></span>
                  Traitement en cours...
                </span>
              </button>
              <a routerLink="/cart" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Retour au panier
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Résumé de la commande</h5>
          <hr>
          
          <div class="mb-3" *ngFor="let item of cartItems">
            <div class="d-flex justify-content-between">
              <span>{{ item.product.name }} x{{ item.quantity }}</span>
              <span>{{ item.product.price * item.quantity }} TND</span>
            </div>
          </div>

          <hr>
          <div class="d-flex justify-content-between mb-2">
            <span>Sous-total</span>
            <span>{{ total }} TND</span>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Livraison</span>
            <span class="text-success">Gratuite</span>
          </div>
          <hr>
          <div class="d-flex justify-content-between">
            <strong>Total</strong>
            <strong class="text-primary h5">{{ total }} TND</strong>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>